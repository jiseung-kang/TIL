# 빠져 있는 장

> 올바르게 정의된 경계, 명확한 책임, 통제된 의존성을 가진 클래스와 컴포넌트

문제는 디테일(구현 세부사항)에 있는 법이다.

설계나 코드 조직화와 관련한 접근법을 알아보자

## 계층 기반 패키지

- 전통적인 수평 계층형 아키텍처
  - 기술적인 관점에서 해당 코드가 하는 일에 기반해 코드를 분할
  - 웹, 업무 규칭, 영속성 코드를 위해 계층이 하나씩 존재
  - 자바의 경우 패키지로 구현되며 의존성은 모두 아래를 향한다.
- 계층형 아키텍처는 업무 도메인에 대해 아무것도 말해주지 않는다.

## 기능 기반 패키지

- 서로 연관된 기능, 도메인 개념 또는 Aggregate Root에 기반해 수직의 얇은 조각으로 코드를 나누는 방식
- 인터페이스와 클래스는 이전과 같지만 모두 단 하나의 패키지에 속한다.
- 계층 기반 패키지를 아주 간단히 리팩터링한 형태로, 코드의 상위 수준 구조가 업무 도메인에 대해 무언가를 알려주게 된다.

## 포트와 어댑터

- 경계, 컨트롤러, 엔티티 방식의 접근
  - 업무/도메인에 초점을 둔 코드가 프레임워크나 데이터베이스같은 기술적인 세부 구현과 독립적이며 분리된 아키텍처를 만들기 위함
  - 코드 베이스는 내부(도메인)와 외부(인프라)로 구성
    - 내부 : 도메인 개념
    - 외부 : UI, 데이터베이스, 서드파티 통합 등의 상호작용
    - 외부가 내부에 의존하며 반대는 안된다.
- 웹은 그저 또 다른 전달 메커니즘

## 컴포넌트 기반 패키지

- 계층형 아키텍처
  - 기능이 같은 코드끼리 분리
  - 의존성 화살표는 항상 아래를 향한다.
  - 각 계층은 반드시 바로 아래 계층에만 의존
  - 비순환 의존성 그래프?
    - 강제성이 우회를 만들수도
    - Big Ball of Mud
- 컴포넌트 기반 패키지
  - 큰 단위 단일 컴포넌트와 관련된 모든 책임을 하나의 패키지로
  - 서비스 중심적인 시각
  - 마이크로서비스 아키텍처
  - 사용자 인터페이스를 큰 단위의 컴포넌트로부터 분리해서 유지

<aside>
💡 컴포넌트는 배포 단위다. 컴포넌트는 시스템의 구성 요소로 배포할 수 있는 가장 작은 단위다.
자바의 경우 jar 파일이 컴포넌트다.

컴포넌트는 멋지고 깔끔한 인터페이스로 감싸진 연관된 기능들의 묶음으로 애플리케이션과 같은 실행 환경 내부에 존재한다.

</aside>

- 소프트웨어 시스템은 하나 이상의 컨테이너로 구성되며 각 컨테이너는 하나 이상의 컴포넌트를 포함한다.
- 각 컴포넌트가 개별 파일로 분리될지 여부는 직교적인 관심사
- 모노리틱 애플리케이션에서 컴포넌트를 잘 정의하면 마이크로 서비스 아키텍처로 갈 발판으로 삼을 수 있다.

## 구현 세부사항엔 항상 문제가 있다.

세부사항을 잘못 구현하면 위 네 가지 접근법이 빠르게 흐트러진다.

## 조직화 vs 캡슐화

- 패키지가 단순히 조직화를 위한 메커니즘으로 전락해 캡슐화를 위한 메커니즘이 될수 없다.
