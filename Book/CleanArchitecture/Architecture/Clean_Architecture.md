# 클린 아키텍처

- 육각형 아키텍처 : 포트와 어댑터
- DCI(Data, Context and Interaction)
- BCE(Boundary-Control-Entity)
- 목표 : 관심사의 분리
  - 소프트웨어를 계층으로 분리해 관심사의 분리를 달성
  - 각 아키텍처는 최소한 업무 규칙을 위한 계층 하나와 사용자와 시스템 인터페이스를 위한 또 다른 계층 하나를 반드시 포함한다.
- 이들 아키텍처의 특징
  - 프레임워크 독립성
  - 테스트 용이성
  - UI 독립성
  - 데이터베이스 독립성
  - 모든 외부 에이전시에 대한 독립성

## 의존성 규칙

안으로 들어갈수록 고수준의 소프트웨어

바깥쪽 원 : 메커니즘

안쪽 원 : 정책

> 소스 코드 의존성은 반드시 안쪽으로, 고수준의 정책을 향해야 한다.

내부 원에 속한 요소는 외부 원에 속한 어떤 것도 알지 못한다.

외부 원에 선언된 데이터 형식도 내부 원에서 절대 사용되선 안된다.

서로 절대 영향을 주지 말자

- 엔티티
  - 전사적인 핵심 업무 규칙 캡슐화
  - 메서드를 가지는 객체이거나 일련의 데이터 구조와 함수의 집합
  - 전사적이지 않은 단순한 단일 애플리케이션이라면 해당 애플리케이션의 업무 객체
  - 가장 일반적이며 고수준인 규칙을 캡슐화
  - 특정 애플리케이션에 무언가 변경이 필요하더라도 엔티티 계층에 절대로 영향을 주면 안된다.
- 유스케이스
  - 애플리케이션에 특화된 업무 규칙을 포함
  - 시스템의 모든 유스케이스를 캡슐화하고 구현한다.
  - 엔티티로 들어오고 나가는 데이터 흐름을 조정
  - 엔티티가 자신의 핵심 업무 규칙을 사용해 유스케이스 목적을 달성하도록 이끈다.
  - 엔티티에 영향을 주면 안되며 영향을 받아도 안되며 격리되어있다.
- 인터페이스 어댑터
  - 데이터를 유스케이스와 엔티티에게 가장 편리한 형식에서 데이터베이스나 웹 같은 외부 에이전시에게 가장 편리한 형식으로 변환
  - GUI의 MVC 아키텍처 포괄 (프레젠터, 뷰, 컨트롤러 모두 여기)
  - 데이터를 외부적인 형식에서 내부적인 형식으로 변환하는 또 다른 어댑터 필요
- 프레임워크와 드라이버
  - 가장 바깥쪽 계층
  - 모든 세부사항
  - 웹은 세부사항
  - 데이터베이스도 세부사항
- 원은 4개여야하나
  - 더 많을수도 있지만
  - 어떤 경우에도 의존성 규칙을 적용해야 한다.
  - 안쪽 원은 가장 범용적이며 높은 수준. 안으로 갈 수록 추상화되고 더 높은 수준의 정책을 캡슐화
- 경계 횡단
  - 컨트롤러와 프레젠터가 유스케이스와 통신
  - 제어흐름과 의존성의 방향이 명확히 반대. 의존성 역전 원칙
  - 직접 호출하면 원들의 규칙을 위배한다.
- 경계를 횡단하는 데이터
  - 구조체, 데이터 전송 객체
  - 데이터 구조가 의존성을 가지면 안된다.
  - 데이터는 내부 원에서 사용하기 가장 편리한 형태

## 전형적인 시나리오

- Controller는 데이터를 객체로 묶어 Interface로 전달한다.
- Interface는 데이터를 해석해서 어떻게 엔터티를 사용할지 Presenter에 전달한다.
- Presenter는 데이터를 화면에 출력할 수 있는 형식으로 재구성한다.

## 결론

이 간단한 규칙들을 적용해

소프트웨어를 계층으로 분리하고 의존성 규칙을 준수하면

테스트하기 쉬운 시스템을 만들 수 있어

요소 교체가 쉬워진다.
